import React from "react";
import { NavLink } from "react-router-dom";

import { useFetchVulnerabilityById } from "@app/queries/vulnerabilities";
import { formatDate } from "@app/utils/utils";
import {
  Button,
  DescriptionList,
  DescriptionListDescription,
  DescriptionListGroup,
  DescriptionListTerm,
} from "@patternfly/react-core";
import ExternalLinkAltIcon from "@patternfly/react-icons/dist/esm/icons/external-link-alt-icon";

import { LoadingWrapper } from "./LoadingWrapper";
import { SeverityShieldAndText } from "./SeverityShieldAndText";

export interface VulnerabilityInDrawerInfoProps {
  vulnerabilityId: string;
}

export const VulnerabilityInDrawerInfo: React.FC<
  VulnerabilityInDrawerInfoProps
> = ({ vulnerabilityId }) => {
  const { vulnerability, isFetching, fetchError } =
    useFetchVulnerabilityById(vulnerabilityId);

  return (
    <LoadingWrapper isFetching={isFetching} fetchError={fetchError}>
      <DescriptionList>
        <DescriptionListGroup>
          <DescriptionListTerm>Identifier</DescriptionListTerm>
          <DescriptionListDescription>
            <Button variant="link" isInline icon={<ExternalLinkAltIcon />}>
              <NavLink to={`/vulnerabilities/${vulnerability?.identifier}`}>
                {vulnerability?.identifier}
              </NavLink>
            </Button>
          </DescriptionListDescription>
        </DescriptionListGroup>
        <DescriptionListGroup>
          <DescriptionListTerm>Severity</DescriptionListTerm>
          <DescriptionListDescription>
            {vulnerability?.average_severity && (
              <SeverityShieldAndText value={vulnerability?.average_severity} />
            )}
          </DescriptionListDescription>
        </DescriptionListGroup>
        <DescriptionListGroup>
          <DescriptionListTerm>Title</DescriptionListTerm>
          <DescriptionListDescription>
            {vulnerability?.title || vulnerability?.description}
          </DescriptionListDescription>
        </DescriptionListGroup>
        <DescriptionListGroup>
          <DescriptionListTerm>CWE</DescriptionListTerm>
          <DescriptionListDescription>
            {vulnerability?.cwe}
          </DescriptionListDescription>
        </DescriptionListGroup>
        <DescriptionListGroup>
          <DescriptionListTerm>Published</DescriptionListTerm>
          <DescriptionListDescription>
            {formatDate(vulnerability?.published)}
          </DescriptionListDescription>
        </DescriptionListGroup>
        <DescriptionListGroup>
          <DescriptionListTerm>Modified</DescriptionListTerm>
          <DescriptionListDescription>
            {formatDate(vulnerability?.modified)}
          </DescriptionListDescription>
        </DescriptionListGroup>
        <DescriptionListGroup>
          <DescriptionListTerm>Withdrawn</DescriptionListTerm>
          <DescriptionListDescription>
            {formatDate(vulnerability?.withdrawn)}
          </DescriptionListDescription>
        </DescriptionListGroup>
        <DescriptionListGroup>
          <DescriptionListTerm>Released</DescriptionListTerm>
          <DescriptionListDescription>
            {formatDate(vulnerability?.released)}
          </DescriptionListDescription>
        </DescriptionListGroup>
      </DescriptionList>
    </LoadingWrapper>
  );
};
