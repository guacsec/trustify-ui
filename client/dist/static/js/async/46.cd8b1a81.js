"use strict";(self.webpackChunk_trustify_ui_client=self.webpackChunk_trustify_ui_client||[]).push([["46"],{92934:function(e,i,t){t.d(i,{F:()=>h,P:()=>y});var l=t(79192),n=t(53195),r=t(24246),a=t(27378),s=t(74502),d=t(32947),o=t(14629),u=t(49988),c=t(17598);let y=a.createContext({}),h=e=>{var i;let{children:t}=e,[h,m]=a.useState(""),[p,v]=a.useState("");a.useEffect(()=>{let e=setTimeout(()=>{v(h)},400);return()=>clearTimeout(e)},[h]);let{labels:x}=(0,c.VY)(p),f=(0,u.vZ)({tableName:"advisory",persistenceKeyPrefix:s.yq.advisories,persistTo:"urlParams",columnNames:{identifier:"ID",title:"Title",type:"Type",labels:"Labels",modified:"Revision",vulnerabilities:"Vulnerabilities"},isPaginationEnabled:!0,isSortEnabled:!0,sortableColumns:["identifier","modified"],initialSort:{columnKey:"modified",direction:"desc"},isFilterEnabled:!0,filterCategories:[{categoryKey:s.L4,title:"Filter text",placeholderText:"Search",type:o.vA.search},{categoryKey:"modified",title:"Revision",type:o.vA.dateRange},{categoryKey:"labels",title:"Label",type:o.vA.autocompleteLabel,placeholderText:"Filter results by label",selectOptions:x.map(e=>{let i=(0,d.W)({key:e.key,value:e.value});return{value:i,label:i}}),onInputValueChange:m}],isExpansionEnabled:!1}),{result:{data:b,total:_},isFetching:j,fetchError:g}=(0,c.N7)((0,u.QO)((0,n._)((0,l._)({},f),{hubSortFieldKeys:{identifier:"identifier",modified:"modified"}})),(null!=(i=f.filterState.filterValues.labels)?i:[]).map(e=>(0,d.nE)(e))),T=(0,u.KC)((0,n._)((0,l._)({},f),{idProperty:"identifier",currentPageItems:b,totalItemCount:_,isLoading:j}));return(0,r.jsx)(y.Provider,{value:{totalItemCount:_,isFetching:j,fetchError:g,tableControls:T},children:t})}},26179:function(e,i,t){t.d(i,{H:()=>L});var l=t(79192),n=t(53195),r=t(24246),a=t(27378),s=t(65783),d=t(46403),o=t(79551),u=t(32489),c=t(90519),y=t(4835),h=t(14350),m=t(11165),p=t(89330),v=t(31423),x=t(94154),f=t(88935),b=t(3804),_=t(31336),j=t(73227),g=t(7615),T=t(49304),K=t(63706),C=t(32947),E=t(73827),q=t(9839),w=t(92934),S=t(15167);let L=()=>{let{isFetching:e,fetchError:i,totalItemCount:t,tableControls:L}=a.useContext(w.P),[k,F]=a.useState(null),P=null!==k,{numRenderedColumns:A,currentPageItems:D,propHelpers:{paginationProps:N,tableProps:V,getThProps:I,getTrProps:R,getTdProps:O},expansionDerivedState:{isCellExpanded:W},filterState:{filterValues:H,setFilterValues:Q}}=L,{downloadAdvisory:Y}=(0,j.i)(),B=()=>{F(null)};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(y.i,(0,n._)((0,l._)({},V),{"aria-label":"advisory-table",children:[(0,r.jsx)(h.h,{children:(0,r.jsx)(m.Tr,{children:(0,r.jsxs)(_.qK,(0,n._)((0,l._)({},L),{children:[(0,r.jsx)(p.Th,(0,l._)({},I({columnKey:"identifier"}))),(0,r.jsx)(p.Th,(0,l._)({},I({columnKey:"title"}))),(0,r.jsx)(p.Th,(0,l._)({},I({columnKey:"type"}))),(0,r.jsx)(p.Th,(0,l._)({},I({columnKey:"labels"}))),(0,r.jsx)(p.Th,(0,l._)({},I({columnKey:"modified"}))),(0,r.jsx)(p.Th,(0,l._)({},I({columnKey:"vulnerabilities"})))]}))})}),(0,r.jsx)(_.hp,{isLoading:e,isError:!!i,isNoData:0===t,numRenderedColumns:A,children:D.map((e,i)=>{let t=e.vulnerabilities.reduce((e,i)=>{let t=(0,g.g)(i.severity);return e[t]=e[t]+1,e},{critical:0,high:0,medium:0,low:0,none:0,unknown:0});return(0,r.jsx)(v.p,{isExpanded:W(e),children:(0,r.jsx)(m.Tr,(0,n._)((0,l._)({},R({item:e})),{children:(0,r.jsxs)(_.Cx,(0,n._)((0,l._)({},L),{item:e,rowIndex:i,children:[(0,r.jsx)(x.Td,(0,n._)((0,l._)({width:15,modifier:"breakWord"},O({columnKey:"identifier",isCompoundExpandToggle:!0,item:e,rowIndex:i})),{children:(0,r.jsx)(s.OL,{to:(0,d.Gn)(q.nB.advisoryDetails,{advisoryId:e.uuid}),children:e.document_id})})),(0,r.jsx)(x.Td,(0,n._)((0,l._)({width:35,modifier:"truncate"},O({columnKey:"title"})),{children:e.title})),(0,r.jsx)(x.Td,(0,n._)((0,l._)({width:10},O({columnKey:"type"})),{children:e.labels.type})),(0,r.jsx)(x.Td,(0,n._)((0,l._)({width:20},O({columnKey:"labels"})),{children:(0,r.jsx)(E.C,{value:e.labels,onClick:e=>{let{key:i,value:t}=e,r=(0,C.W)({key:i,value:t}),a=H.labels;if(!(null==a?void 0:a.includes(r))){let e=a?[...a,r]:[r];Q((0,n._)((0,l._)({},H),{labels:e}))}}})})),(0,r.jsx)(x.Td,(0,n._)((0,l._)({width:10,modifier:"truncate"},O({columnKey:"modified"})),{children:(0,K.p6)(e.modified)})),(0,r.jsx)(x.Td,(0,n._)((0,l._)({width:10},O({columnKey:"vulnerabilities"})),{children:(0,r.jsx)(T.u,{severities:t})})),(0,r.jsx)(x.Td,{isActionCell:!0,children:(0,r.jsx)(f.k,{items:[{title:"Edit labels",onClick:()=>{F(e)}},{isSeparator:!0},{title:"Download",onClick:()=>{Y(e.uuid,"".concat(e.identifier,".json"))}}]})})]}))}))},e.identifier)})})]})),(0,r.jsx)(b.p,{idPrefix:"advisory-table",isTop:!1,paginationProps:N}),(0,r.jsxs)(o.u,{isOpen:P,variant:"medium",onClose:B,children:[(0,r.jsx)(u.x,{title:"Edit labels"}),(0,r.jsx)(c.f,{children:k&&(0,r.jsx)(S.q,{advisory:k,onClose:B})})]})]})}},80475:function(e,i,t){t.d(i,{P:()=>h});var l=t(79192),n=t(53195),r=t(24246),a=t(27378),s=t(70715),d=t(40982),o=t(89226),u=t(14629),c=t(3804),y=t(92934);let h=e=>{let{showFilters:i}=e,{tableControls:t}=a.useContext(y.P),{propHelpers:{toolbarProps:h,filterToolbarProps:m,paginationToolbarItemProps:p,paginationProps:v}}=t;return(0,r.jsx)(s.o,(0,n._)((0,l._)({},h),{"aria-label":"advisory-toolbar",children:(0,r.jsxs)(d.c,{children:[i&&(0,r.jsx)(u.Ki,(0,l._)({},m)),(0,r.jsx)(o.E,(0,n._)((0,l._)({},p),{children:(0,r.jsx)(c.p,{idPrefix:"advisory-table",isTop:!0,paginationProps:v})}))]})}))}},15167:function(e,i,t){t.d(i,{q:()=>d});var l=t(24246),n=t(27378),r=t(24502),a=t(15726),s=t(17598);let d=e=>{let{advisory:i,onClose:t}=e,{pushNotification:d}=n.useContext(a.c),[o,u]=n.useState(""),[c,y]=n.useState(""),{labels:h}=(0,s.VY)(c);n.useEffect(()=>{let e=setTimeout(()=>{y(o)},400);return()=>clearTimeout(e)},[o]);let{mutate:m,isPending:p}=(0,s.sj)(()=>{d({title:"Labels updated for Advisory ".concat(i.document_id),variant:"success"}),t()},e=>{d({title:"Error while updating labels for Advisory ".concat(i.document_id),variant:"danger"})});return(0,l.jsx)(r.M,{title:"Labels of Advisory: ".concat(i.document_id),value:i.labels,isDisabled:p,onSave:e=>{m({id:i.uuid,labels:e})},onClose:t,onInputChange:u,options:h})}},17598:function(e,i,t){t.d(i,{N7:()=>x,VY:()=>v,gw:()=>f,sj:()=>_,tG:()=>b});var l=t(79192),n=t(53195),r=t(70186),a=t(1183),s=t(24038),d=t(68e3),o=t(75503),u=t(50576),c=t(40371),y=t(87017),h=t(49988),m=t(95169);let p="advisories",v=e=>{let{data:i,isLoading:t,error:l,refetch:n}=(0,a.a)({queryKey:[p,"labels",e],queryFn:()=>(0,c.sf)({client:u.L,query:{limit:10,filter_text:e}}),placeholderData:s.Wk});return{labels:(null==i?void 0:i.data)||[],isFetching:t,fetchError:l,refetch:n}},x=function(){var e,i,t;let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],y=(0,h.rm)(s),{q:m}=y,v=(0,r._)(y,["q"]),x=(0,h.Rb)(d),{data:f,isLoading:b,error:_,refetch:j}=(0,a.a)({queryKey:[p,s,x],queryFn:()=>(0,c.A1)({client:u.L,query:(0,n._)((0,l._)({},v),{q:[m,x].filter(e=>e).join("&")})}),enabled:!o});return{result:{data:(null==f||null==(e=f.data)?void 0:e.items)||[],total:null!=(t=null==f||null==(i=f.data)?void 0:i.total)?t:0,params:s},isFetching:b,fetchError:_||null,refetch:j}},f=e=>{let{data:i,isLoading:t,error:l}=(0,a.a)({queryKey:[p,e],queryFn:()=>(0,c.pB)({client:u.L,path:{key:e}}),enabled:void 0!==e});return{advisory:null==i?void 0:i.data,isFetching:t,fetchError:l}},b=()=>{let e=(0,d.NL)();return(0,m.V)({parallel:!0,uploadFn:(e,i)=>(0,y.Cu)(e,i),onSuccess:async()=>{await e.invalidateQueries({queryKey:[p]})}})},_=(e,i)=>{let t=(0,d.NL)();return(0,o.D)({mutationFn:e=>(0,c.m5)({client:u.L,path:{id:e.id},body:e.labels}),onSuccess:async(i,l)=>{e(),await t.invalidateQueries({queryKey:[p]})},onError:i})}}}]);