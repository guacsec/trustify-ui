"use strict";(self.webpackChunk_trustify_ui_client=self.webpackChunk_trustify_ui_client||[]).push([["46"],{92934:function(e,i,t){t.d(i,{F:()=>c,P:()=>u});var l=t(24246),s=t(27378),r=t(74502),n=t(32947),a=t(14629),d=t(49988),o=t(17598);let u=s.createContext({}),c=e=>{let{children:i}=e,[t,c]=s.useState(""),[y,h]=s.useState("");s.useEffect(()=>{let e=setTimeout(()=>{h(t)},400);return()=>clearTimeout(e)},[t]);let{labels:m}=(0,o.useFetchAdvisoryLabels)(y),p=(0,d.vZ)({tableName:"advisory",persistenceKeyPrefix:r.yq.advisories,persistTo:"urlParams",columnNames:{identifier:"ID",title:"Title",type:"Type",labels:"Labels",modified:"Revision",vulnerabilities:"Vulnerabilities"},isPaginationEnabled:!0,isSortEnabled:!0,sortableColumns:["identifier","modified"],initialSort:{columnKey:"modified",direction:"desc"},isFilterEnabled:!0,filterCategories:[{categoryKey:r.L4,title:"Filter text",placeholderText:"Search",type:a.vA.search},{categoryKey:"modified",title:"Revision",type:a.vA.dateRange},{categoryKey:"labels",title:"Label",type:a.vA.autocompleteLabel,placeholderText:"Filter results by label",selectOptions:m.map(e=>{let i=(0,n.W)({key:e.key,value:e.value});return{value:i,label:i}}),onInputValueChange:c}],isExpansionEnabled:!1}),{result:{data:x,total:v},isFetching:b,fetchError:f}=(0,o.useFetchAdvisories)((0,d.QO)({...p,hubSortFieldKeys:{identifier:"identifier",modified:"modified"}}),(p.filterState.filterValues.labels??[]).map(e=>(0,n.nE)(e))),j=(0,d.KC)({...p,idProperty:"identifier",currentPageItems:x,totalItemCount:v,isLoading:b});return(0,l.jsx)(u.Provider,{value:{totalItemCount:v,isFetching:b,fetchError:f,tableControls:j},children:i})}},26179:function(e,i,t){t.d(i,{H:()=>L});var l=t(24246),s=t(27378),r=t(65783),n=t(79551),a=t(32489),d=t(90519),o=t(4835),u=t(14350),c=t(11165),y=t(89330),h=t(31423),m=t(94154),p=t(88935),x=t(3804),v=t(31336),b=t(73227),f=t(7615),j=t(49304),g=t(63706),T=t(32947),K=t(73827),C=t(92934),F=t(15167);let L=()=>{let{isFetching:e,fetchError:i,totalItemCount:t,tableControls:L}=s.useContext(C.P),[E,A]=s.useState(null),w=null!==E,{numRenderedColumns:S,currentPageItems:q,propHelpers:{paginationProps:k,tableProps:P,getThProps:_,getTrProps:D,getTdProps:I},expansionDerivedState:{isCellExpanded:Q},filterState:{filterValues:N,setFilterValues:O}}=L,{downloadAdvisory:R}=(0,b.useDownload)(),$=()=>{A(null)};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(o.i,{...P,"aria-label":"advisory-table",children:[(0,l.jsx)(u.h,{children:(0,l.jsx)(c.Tr,{children:(0,l.jsxs)(v.qK,{...L,children:[(0,l.jsx)(y.Th,{..._({columnKey:"identifier"})}),(0,l.jsx)(y.Th,{..._({columnKey:"title"})}),(0,l.jsx)(y.Th,{..._({columnKey:"type"})}),(0,l.jsx)(y.Th,{..._({columnKey:"labels"})}),(0,l.jsx)(y.Th,{..._({columnKey:"modified"})}),(0,l.jsx)(y.Th,{..._({columnKey:"vulnerabilities"})})]})})}),(0,l.jsx)(v.hp,{isLoading:e,isError:!!i,isNoData:0===t,numRenderedColumns:S,children:q.map((e,i)=>{let t=e.vulnerabilities.reduce((e,i)=>{let t=(0,f.g)(i.severity);return Object.assign(e,{[t]:e[t]+1})},{critical:0,high:0,medium:0,low:0,none:0,unknown:0});return(0,l.jsx)(h.p,{isExpanded:Q(e),children:(0,l.jsx)(c.Tr,{...D({item:e}),children:(0,l.jsxs)(v.Cx,{...L,item:e,rowIndex:i,children:[(0,l.jsx)(m.Td,{width:15,modifier:"breakWord",...I({columnKey:"identifier",isCompoundExpandToggle:!0,item:e,rowIndex:i}),children:(0,l.jsx)(r.OL,{to:`/advisories/${e.uuid}`,children:e.document_id})}),(0,l.jsx)(m.Td,{width:35,modifier:"truncate",...I({columnKey:"title"}),children:e.title}),(0,l.jsx)(m.Td,{width:10,...I({columnKey:"type"}),children:e.labels.type}),(0,l.jsx)(m.Td,{width:20,...I({columnKey:"labels"}),children:(0,l.jsx)(K.C,{value:e.labels,onClick:e=>{let{key:i,value:t}=e,l=(0,T.W)({key:i,value:t}),s=N.labels;if(!s?.includes(l)){let e=s?[...s,l]:[l];O({...N,labels:e})}}})}),(0,l.jsx)(m.Td,{width:10,modifier:"truncate",...I({columnKey:"modified"}),children:(0,g.p6)(e.modified)}),(0,l.jsx)(m.Td,{width:10,...I({columnKey:"vulnerabilities"}),children:(0,l.jsx)(j.u,{severities:t})}),(0,l.jsx)(m.Td,{isActionCell:!0,children:(0,l.jsx)(p.k,{items:[{title:"Edit labels",onClick:()=>{A(e)}},{isSeparator:!0},{title:"Download",onClick:()=>{R(e.uuid,`${e.identifier}.json`)}}]})})]})})},e.identifier)})})]}),(0,l.jsx)(x.p,{idPrefix:"advisory-table",isTop:!1,paginationProps:k}),(0,l.jsxs)(n.u,{isOpen:w,variant:"medium",onClose:$,children:[(0,l.jsx)(a.x,{title:"Edit labels"}),(0,l.jsx)(d.f,{children:E&&(0,l.jsx)(F.q,{advisory:E,onClose:$})})]})]})}},80475:function(e,i,t){t.d(i,{P:()=>c});var l=t(24246),s=t(27378),r=t(70715),n=t(40982),a=t(89226),d=t(14629),o=t(3804),u=t(92934);let c=e=>{let{showFilters:i}=e,{tableControls:t}=s.useContext(u.P),{propHelpers:{toolbarProps:c,filterToolbarProps:y,paginationToolbarItemProps:h,paginationProps:m}}=t;return(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(r.o,{...c,children:(0,l.jsxs)(n.c,{children:[i&&(0,l.jsx)(d.Ki,{...y}),(0,l.jsx)(a.E,{...h,children:(0,l.jsx)(o.p,{idPrefix:"advisory-table",isTop:!0,paginationProps:m})})]})})})}},15167:function(e,i,t){t.d(i,{q:()=>d});var l=t(24246),s=t(27378),r=t(24502),n=t(15726),a=t(17598);let d=e=>{let{advisory:i,onClose:t}=e,{pushNotification:d}=s.useContext(n.c),[o,u]=s.useState(""),[c,y]=s.useState(""),{labels:h}=(0,a.useFetchAdvisoryLabels)(c);s.useEffect(()=>{let e=setTimeout(()=>{y(o)},400);return()=>clearTimeout(e)},[o]);let{mutate:m,isPending:p}=(0,a.useUpdateAdvisoryLabelsMutation)(()=>{d({title:`Labels updated for Advisory ${i.document_id}`,variant:"success"}),t()},e=>{d({title:`Error while updating labels for Advisory ${i.document_id}`,variant:"danger"})});return(0,l.jsx)(r.M,{title:`Labels of Advisory: ${i.document_id}`,value:i.labels,isDisabled:p,onSave:e=>{m({id:i.uuid,labels:e})},onClose:t,onInputChange:u,options:h})}},17598:function(e,i,t){t.d(i,{useFetchAdvisories:()=>m,useFetchAdvisoryById:()=>p,useFetchAdvisoryLabels:()=>h,useUpdateAdvisoryLabelsMutation:()=>v,useUploadAdvisory:()=>x});var l=t(1183),s=t(24038),r=t(68e3),n=t(75503),a=t(50576),d=t(40371),o=t(87017),u=t(49988),c=t(95169);let y="advisories",h=e=>{let{data:i,isLoading:t,error:r,refetch:n}=(0,l.useQuery)({queryKey:[y,"labels",e],queryFn:()=>(0,d.sf)({client:a.L,query:{limit:10,filter_text:e}}),placeholderData:s.Wk});return{labels:i?.data||[],isFetching:t,fetchError:r,refetch:n}},m=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],{q:s,...r}=(0,u.rm)(e),n=(0,u.Rb)(i),{data:o,isLoading:c,error:h,refetch:m}=(0,l.useQuery)({queryKey:[y,e,n],queryFn:()=>(0,d.A1)({client:a.L,query:{...r,q:[s,n].filter(e=>e).join("&")}}),enabled:!t});return{result:{data:o?.data?.items||[],total:o?.data?.total??0,params:e??e},isFetching:c,fetchError:h||null,refetch:m}},p=e=>{let{data:i,isLoading:t,error:s}=(0,l.useQuery)({queryKey:[y,e],queryFn:()=>(0,d.pB)({client:a.L,path:{key:e}}),enabled:void 0!==e});return{advisory:i?.data,isFetching:t,fetchError:s}},x=()=>{let e=(0,r.NL)();return(0,c.V)({parallel:!0,uploadFn:(e,i)=>(0,o.Cu)(e,i),onSuccess:async()=>{await e.invalidateQueries({queryKey:[y]})}})},v=(e,i)=>{let t=(0,r.NL)();return(0,n.D)({mutationFn:e=>(0,d.m5)({client:a.L,path:{id:e.id},body:e.labels}),onSuccess:async(i,l)=>{e(),await t.invalidateQueries({queryKey:[y]})},onError:i})}}}]);