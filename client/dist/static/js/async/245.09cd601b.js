"use strict";(self.webpackChunk_trustify_ui_client=self.webpackChunk_trustify_ui_client||[]).push([["245"],{68057:function(e,t,r){r.d(t,{V:()=>a});var s=r(24246),i=r(27378),n=r(63763),l=r(32947);let a=e=>{let{vulnerabilitiesSummary:t}=e,r=i.useMemo(()=>Object.keys(t.severities).map(e=>{let r=t.severities[e],s=l.V4[e];return{severity:e,count:r,label:s.name,color:s.color.value}}).sort((0,l.A0)(e=>e.severity)).reverse(),[t]);return(0,s.jsx)("div",{style:{height:"230px",maxWidth:"350px"},children:(0,s.jsx)(n.H,{constrainToVisibleArea:!0,legendOrientation:"vertical",legendPosition:"right",padding:{bottom:20,left:20,right:140,top:20},title:`${t.total}`,subTitle:"Total vulnerabilities",width:350,legendData:r.map(e=>{let{label:t,count:r}=e;return{name:`${t}: ${r}`}}),data:r.map(e=>{let{label:t,count:r}=e;return{x:t,y:r}}),labels:e=>{let{datum:t}=e;return`${t.x}: ${t.y}`},colorScale:r.map(e=>{let{color:t}=e;return t})})})}},21629:function(e,t,r){r.r(t),r.d(t,{default:()=>eu});var s=r(24246),i=r(45043),n=r(27317),l=r(93095),a=r(14935),d=r(65783),c=r(74485),o=r(76228),h=r(57518),u=r(24216),x=r(13864),m=r(78531),j=r(44870),y=r(93591),v=r(31757),g=r(87069),p=r(51527),b=r(87727),f=r(3498),S=r(68802),F=r(10707),O=r(16668),k=r(30329),B=r(50689),P=r(67761),C=r(81391),M=r(32947),w=r(37818),E=r(82413),V=r(17598),$=r(43959),L=r(63706);let T=[{severity:"critical"},{severity:"high"},{severity:"medium"},{severity:"low"},{severity:"none"},{severity:"unknown"}],A=()=>{let e=(0,a.s0)(),{result:{data:t,total:r},isFetching:i,fetchError:A}=(0,$.useFetchSBOMs)({page:{pageNumber:1,itemsPerPage:10},sort:{field:"ingested",direction:"desc"}}),{data:I,isFetching:K,fetchError:q}=(0,E.useVulnerabilitiesOfSboms)(t.map(e=>e.id)),D=I.map(e=>e.summary.vulnerabilityStatus.affected.total).every(e=>0===e),N=(e,t)=>`${" ".repeat(t+1)}${e.name}`,{result:{data:Q,total:_},isFetching:G,fetchError:U}=(0,V.useFetchAdvisories)({page:{pageNumber:1,itemsPerPage:10},sort:{field:"ingested",direction:"desc"}});return(0,s.jsxs)(v.Z,{children:[(0,s.jsx)(g.l,{children:"Dashboard"}),(0,s.jsx)(p.e,{children:(0,s.jsxs)(b.r,{children:[(0,s.jsx)(f.P,{md:6,children:(0,s.jsx)(w.u,{isFetching:i||K,fetchError:A||q.some(e=>!!e),children:(0,s.jsxs)(n.K,{hasGutter:!0,children:[(0,s.jsx)(l.v,{children:(0,s.jsx)(S.V,{children:"Below is a summary of Vulnerability status for the last 10 ingested SBOMs. To view the details, click on an SBOM name. You can also select up to 4 SBOMs to watch."})}),(0,s.jsx)(l.v,{children:t.length>0?(0,s.jsx)("div",{style:{height:320},children:(0,s.jsxs)(c.k,{ariaDesc:"SBOM summary status",domainPadding:{x:[30,25]},legendData:T.map(e=>({name:M.V4[e.severity].name})),legendPosition:"bottom-left",height:375,name:"sbom-summary-status",padding:{bottom:75,left:330,right:50,top:50},themeColor:o.n.multiOrdered,width:700,legendComponent:(0,s.jsx)(h.Q,{y:10,x:200,colorScale:T.map(e=>M.V4[e.severity].color.value)}),children:[(0,s.jsx)(u.C,{label:"Products",axisLabelComponent:(0,s.jsx)(x.D,{dx:0,x:15,y:140}),tickLabelComponent:(0,s.jsx)(x.D,{className:"pf-v6-c-button pf-m-link pf-m-inline",style:[{fill:"#0066cc"}],events:{onClick:r=>{let s=r.target.innerHTML,i=t.find((e,t)=>N(e,t)===s);i&&e(`/sboms/${i.id}`)}}})}),(0,s.jsx)(u.C,{dependentAxis:!0,showGrid:!0,tickValues:D?[1,2,3,4,5,6,7,8,9,10]:void 0,label:"Vulnerabilities by Severity",fixLabelOverlap:!0}),(0,s.jsx)(m.K,{horizontal:!0,colorScale:T.map(e=>M.V4[e.severity].color.value),children:T.map(e=>{let r=M.V4[e.severity];return(0,s.jsx)(j.B,{labelComponent:(0,s.jsx)(y.h,{constrainToVisibleArea:!0}),data:I.map((s,i)=>{let{summary:{vulnerabilityStatus:{affected:n}}}=s,l=t[i],a=e.severity,d=n.severities[a];return{x:N(l,i),y:d,label:`${r.name}: ${d}`}})},e.severity)})})]})}):(0,s.jsx)(F.ub,{headingLevel:"h4",titleText:"There is nothing here yet",variant:F.IQ.xs,children:(0,s.jsx)(O.B,{children:"You can get started by uploading an SBOM. Once your SBOMs are uploaded come back to this page to see your overview."})})})]})})}),(0,s.jsx)(f.P,{md:6,children:(0,s.jsx)(w.u,{isFetching:G||i,fetchError:U||A,children:(0,s.jsxs)(b.r,{hasGutter:!0,children:[(0,s.jsx)(f.P,{md:6,children:(0,s.jsx)(k.o,{children:(0,s.jsxs)(B.g,{children:[(0,s.jsx)(P.M,{children:"Last SBOM ingested"}),(0,s.jsx)(C.b,{children:(0,s.jsxs)(n.K,{children:[(0,s.jsx)(l.v,{children:(0,L.o0)(t?.[0]?.ingested)}),(0,s.jsx)(l.v,{children:(0,s.jsx)(d.rU,{to:`/sboms/${t?.[0]?.id}`,children:t?.[0]?.name})})]})})]})})}),(0,s.jsx)(f.P,{md:6,children:(0,s.jsx)(k.o,{children:(0,s.jsxs)(B.g,{children:[(0,s.jsx)(P.M,{children:"Total SBOMs"}),(0,s.jsx)(C.b,{children:r})]})})}),(0,s.jsx)(f.P,{md:6,children:(0,s.jsx)(k.o,{children:(0,s.jsxs)(B.g,{children:[(0,s.jsx)(P.M,{children:"Last Advisory ingested"}),(0,s.jsx)(C.b,{children:(0,s.jsxs)(n.K,{children:[(0,s.jsx)(l.v,{children:(0,L.o0)(Q?.[0]?.ingested)}),(0,s.jsx)(l.v,{children:(0,s.jsx)(d.rU,{to:`/advisories/${Q?.[0]?.uuid}`,children:Q?.[0]?.document_id})})]})})]})})}),(0,s.jsx)(f.P,{md:6,children:(0,s.jsx)(k.o,{children:(0,s.jsxs)(B.g,{children:[(0,s.jsx)(P.M,{children:"Total Advisories"}),(0,s.jsx)(C.b,{children:_})]})})})]})})})]})})]})};var I=r(27378),K=r(8305),q=r(13754),D=r(15726),N=r(1183),Q=r(68e3),_=r(75503),G=r(50576),U=r(40371);let W="watched-sboms",Z="dashboard",H=()=>{let{data:e,isLoading:t,error:r}=(0,N.useQuery)({queryKey:[Z,W],queryFn:async()=>{try{return(await (0,U.JM)({client:G.L,path:{key:W}})).data}catch(e){if(404===e.status)return{sbom1Id:null,sbom2Id:null,sbom3Id:null,sbom4Id:null}}}});return{sboms:e,isFetching:t,fetchError:r}},Y=(e,t)=>{let r=(0,Q.NL)();return(0,_.D)({mutationFn:e=>(0,U.yu)({client:G.L,path:{key:W},body:e}),onSuccess:async(t,s)=>{e(),await r.invalidateQueries({queryKey:[Z,W]})},onError:t})},z=I.createContext({}),R=e=>{let{children:t}=e,{pushNotification:r}=I.useContext(D.c),{sboms:i,isFetching:n,fetchError:l}=H(),{mutate:a}=Y(()=>{},e=>{r({title:"Error while updating the user preferences",variant:"danger"})});return(0,s.jsx)(z.Provider,{value:{sboms:i,isFetching:n,fetchError:l,patch:(e,t)=>{a({...i,[e]:t})}},children:t})};var J=r(46039),X=r(18037),ee=r(24620),et=r(9426),er=r(32050),es=r(99589),ei=r(17528),en=r(32623),el=r(42364),ea=r(29765),ed=r(68057);let ec=e=>{let{sbomId:t}=e,{data:r,isFetching:i,fetchError:n}=(0,E.useVulnerabilitiesOfSbom)(t);return(0,s.jsx)(w.u,{isFetching:i,fetchError:n,children:(0,s.jsx)(ed.V,{vulnerabilitiesSummary:r.summary.vulnerabilityStatus.affected})})},eo=e=>{let{fieldName:t,sbomId:r}=e,{patch:i}=I.useContext(z),a=I.useRef(),[c,o]=I.useState(""),[h,u]=I.useState("");I.useEffect(()=>{let e=setTimeout(()=>{u(c)},500);return()=>clearTimeout(e)},[c]);let[x,m]=I.useState(!1),{sbom:j,isFetching:y,fetchError:b}=(0,$.useFetchSBOMById)(r??void 0),{result:{data:f}}=(0,$.useFetchSBOMs)({filters:[{field:"",operator:"~",value:h}],page:{pageNumber:1,itemsPerPage:10},sort:{field:"ingested",direction:"desc"}}),S=()=>{m(!1)},k=()=>{m(!x)},B=()=>{x?c||S():m(!0)},P=(e,t)=>{o(t)},C=()=>{o(""),a?.current?.focus()};return(0,s.jsxs)(v.Z,{isFullHeight:!0,children:[(0,s.jsxs)(w.u,{isFetching:y,fetchError:b,children:[j&&(0,s.jsx)(g.l,{children:j?.name}),(0,s.jsx)(p.e,{children:r?(0,s.jsxs)(n.K,{children:[(0,s.jsx)(l.v,{isFilled:!0,children:(0,s.jsx)(ec,{sbomId:r})}),(0,s.jsx)(l.v,{children:(0,s.jsx)(d.rU,{to:`/sboms/${r}`,children:"View Details"})})]}):(0,s.jsx)(F.ub,{headingLevel:"h4",titleText:"There is nothing here yet",variant:F.IQ.xs,children:(0,s.jsx)(O.B,{children:"You can get started by uploading an SBOM. Once your SBOMs are uploaded come back to this page to change the SBOMs you would like to track."})})})]}),(0,s.jsx)(J.e,{children:(0,s.jsx)(X.P,{shouldFocusFirstItemOnOpen:!1,isOpen:x,onSelect:(e,r)=>{r&&i(t,r),S()},onOpenChange:e=>{e||S()},toggle:e=>(0,s.jsx)(ee.O_,{ref:e,variant:"typeahead",onClick:k,isExpanded:x,isFullWidth:!0,children:(0,s.jsxs)(et.W,{isPlain:!0,children:[(0,s.jsx)(er.v,{autoComplete:"off",value:c,onClick:B,onChange:P,innerRef:a,isExpanded:x,placeholder:"Select a new SBOM to watch"}),(0,s.jsx)(es.t,{...!c?{style:{display:"none"}}:{},children:(0,s.jsx)(ei.zx,{icon:(0,s.jsx)(ea.ZP,{"aria-hidden":!0}),variant:"plain",onClick:C,"aria-label":"Clear input value"})})]})}),children:(0,s.jsx)(en.E,{children:f.map(e=>(0,s.jsx)(el.$,{value:e.id,children:e.name},e.id))})})})]})},eh=()=>{let{sboms:e,isFetching:t,fetchError:r}=I.useContext(z);return(0,s.jsx)(w.u,{isFetching:t,fetchError:r,isFetchingState:(0,s.jsx)(b.r,{hasGutter:!0,children:Array.from([,,,,].keys()).map(e=>(0,s.jsx)(f.P,{md:3,children:(0,s.jsx)(v.Z,{children:(0,s.jsx)(p.e,{children:(0,s.jsx)(K.b,{children:(0,s.jsx)(q.$,{})})})})},e))}),children:(0,s.jsx)(b.r,{hasGutter:!0,children:e&&Object.entries(e).map(e=>{let[t,r]=e;return(0,s.jsx)(f.P,{md:3,children:(0,s.jsx)(eo,{fieldName:t,sbomId:r})},`${t}:${r}`)})})})},eu=()=>(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(i.NP,{hasBodyWrapper:!1,children:(0,s.jsxs)(n.K,{hasGutter:!0,children:[(0,s.jsx)(l.v,{children:(0,s.jsx)(A,{})}),(0,s.jsx)(l.v,{children:(0,s.jsx)(R,{children:(0,s.jsx)(eh,{})})})]})})})},17598:function(e,t,r){r.d(t,{useFetchAdvisories:()=>h,useFetchAdvisoryById:()=>u,useUploadAdvisory:()=>x});var s=r(1183),i=r(68e3),n=r(50576),l=r(40371),a=r(87017),d=r(47169),c=r(95169);let o="advisories",h=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{data:r,isLoading:i,error:a,refetch:c}=(0,s.useQuery)({queryKey:[o,e],queryFn:()=>(0,l.A1)({client:n.L,query:{...(0,d.rm)(e)}}),enabled:!t});return{result:{data:r?.data?.items||[],total:r?.data?.total??0,params:e??e},isFetching:i,fetchError:a||null,refetch:c}},u=e=>{let{data:t,isLoading:r,error:i}=(0,s.useQuery)({queryKey:[o,e],queryFn:()=>(0,l.pB)({client:n.L,path:{key:e}}),enabled:void 0!==e});return{advisory:t?.data,isFetching:r,fetchError:i}},x=()=>{let e=(0,i.NL)();return(0,c.V)({parallel:!0,uploadFn:(e,t)=>(0,a.Cu)(e,t),onSuccess:async()=>{await e.invalidateQueries({queryKey:[o]})}})}}}]);