"use strict";(self.webpackChunk_trustify_ui_client=self.webpackChunk_trustify_ui_client||[]).push([[669],{55399:(e,t,a)=>{a.d(t,{Kb:()=>i,Sx:()=>u,YT:()=>c});var r=a(44304),n=a(19174),l=a(53820),s=a(86361),o=a(53359);const i={none:{name:"None",color:r.p,progressProps:{variant:void 0}},low:{name:"Low",color:n.n,progressProps:{variant:void 0}},medium:{name:"Medium",color:l.H,progressProps:{variant:"warning"}},high:{name:"High",color:s.u,progressProps:{variant:"danger"}},critical:{name:"Critical",color:o.c,progressProps:{variant:"danger"}}},c=e=>{switch(e){case"low":return 1;case"medium":return 2;case"high":return 3;case"critical":return 4;default:return 0}};function u(e){return(t,a)=>c(e(t))-c(e(a))}},81230:(e,t,a)=>{a.d(t,{J4:()=>u,hP:()=>c});var r=a(64917),n=a(86820);a(63260);const l="/api",s=l+"/v1/advisory",o=l+"/v1/sbom",i=e=>{let t="application/json";return(e.name.endsWith(".bz2")||e.name.endsWith(".gz"))&&(t="application/json+bzip2"),t},c=(e,t)=>{const a=e.get(n.fs);return r.A.post(`${s}`,a,{...t,headers:{"Content-Type":i(a)}})},u=(e,t)=>{const a=e.get(n.fs);return r.A.post(`${o}`,a,{...t,headers:{"Content-Type":i(a)}})}},24417:(e,t,a)=>{a.d(t,{a:()=>o});var r=a(63696),n=a(59394),l=a(99135),s=a(75855);const o=e=>e.isFetching?e.isFetchingState||r.createElement(n.a,null,r.createElement(l.y,null)):e.fetchError?e.fetchErrorState||r.createElement(s.q,null):e.children},27473:(e,t,a)=>{a.d(t,{Y:()=>s});var r=a(63696),n=a(18045),l=a(55399);const s=({vulnerabilitiesSummary:e})=>{const t=r.useMemo((()=>Object.keys(e.severities).map((t=>{const a=t,r=e.severities[a],n=l.Kb[a];return{severity:a,count:r,label:n.name,color:n.color.value}})).sort((0,l.Sx)((e=>e.severity)))),[e]);return r.createElement("div",{style:{height:"230px",maxWidth:"350px"}},r.createElement(n.H,{constrainToVisibleArea:!0,legendOrientation:"vertical",legendPosition:"right",padding:{bottom:20,left:20,right:140,top:20},title:`${e.total}`,subTitle:"Total vulnerabilities",width:350,legendData:t.map((({label:e,count:t})=>({name:`${e}: ${t}`}))),data:t.map((({label:e,count:t})=>({x:e,y:t}))),labels:({datum:e})=>`${e.x}: ${e.y}`,colorScale:t.map((({color:e})=>e))}))}},75855:(e,t,a)=>{a.d(t,{q:()=>u});var r=a(63696),n=a(63863),l=a(97157),s=a(2408),o=a(92411),i=a(60087),c=a(45960);const u=()=>r.createElement(n.p,{variant:n.s.sm},r.createElement(l.q,{icon:i.Ay,color:c.D.value}),r.createElement(s.h,{headingLevel:"h2",size:"lg"},"Unable to connect"),r.createElement(o.h,null,"There was an error retrieving data. Check your connection and try again."))},89101:(e,t,a)=>{a.d(t,{U:()=>i,n:()=>c});var r=a(63696),n=a(91728);const l={total:0,severities:{none:0,low:0,medium:0,high:0,critical:0}},s={vulnerabilityStatus:{affected:{...l},fixed:{...l},not_affected:{...l},known_not_affected:{...l}}},o=e=>{const t=e.flatMap((e=>(e.status??[]).map((t=>({vulnerability:t,advisory:e,vulnerabilityStatus:t.status,packages:t.packages||[]}))))),a=t.reduce(((e,t)=>{const a=t.vulnerabilityStatus,r=t.vulnerability.average_severity,n=e.vulnerabilityStatus[a];return{...e,vulnerabilityStatus:{...e.vulnerabilityStatus,[a]:{total:n.total+1,severities:{...n.severities,[r]:n.severities[r]+1}}}}}),s);return{vulnerabilities:t,summary:a}},i=e=>{const{advisories:t,isFetching:a,fetchError:l}=(0,n.DH)(e);return{data:r.useMemo((()=>o(t||[])),[t]),isFetching:a,fetchError:l}},c=e=>{const{advisories:t,isFetching:a,fetchError:l}=(0,n.zY)(e);return{data:r.useMemo((()=>(t??[]).map((e=>o(e||[])))),[t]),isFetching:a,fetchError:l}}},24808:(e,t,a)=>{a.d(t,{v:()=>i});var r=a(63696),n=a(64917),l=a(86820);const s="cancelled",o=(e,t)=>{switch(t.type){case"queueUpload":return{...e,uploads:new Map(e.uploads).set(t.payload.file,{...e.uploads.get(t.payload.file)||{progress:0,status:"queued",error:void 0,response:void 0,wasCancelled:!1,cancelFn:void 0},status:"queued",cancelFn:t.payload.cancelFn})};case"updateUploadProgress":return{...e,uploads:new Map(e.uploads).set(t.payload.file,{...e.uploads.get(t.payload.file)||{progress:0,status:"queued",error:void 0,response:void 0,wasCancelled:!1,cancelFn:void 0},progress:t.payload.progress||0,status:"inProgress"})};case"finishUploadSuccessfully":return{...e,uploads:new Map(e.uploads).set(t.payload.file,{...e.uploads.get(t.payload.file),status:"complete",response:t.payload.response})};case"finishUploadWithError":return{...e,uploads:new Map(e.uploads).set(t.payload.file,{...e.uploads.get(t.payload.file),status:"complete",error:t.payload.error,wasCancelled:t.payload.error?.message===s})};case"removeUpload":{const a=new Map(e.uploads);return a.delete(t.payload.file),{...e,uploads:a}}default:throw new Error}},i=({parallel:e,uploadFn:t,onSuccess:a,onError:i})=>{const[c,u]=r.useReducer(o,{uploads:new Map});return{uploads:c.uploads,handleUpload:r=>{const o=[];for(let e=0;e<r.length;e++){const t=r[e],c=new FormData;c.set(l.fs,t);const d=n.A.CancelToken.source(),m={headers:{"X-Requested-With":"XMLHttpRequest"},onUploadProgress:e=>{const a=e.total??1,r=e.loaded/a*100;u({type:"updateUploadProgress",payload:{file:t,progress:Math.round(r)}})},cancelToken:d.token};u({type:"queueUpload",payload:{file:t,cancelFn:d}});const p={formData:c,config:m,thenFn:e=>{u({type:"finishUploadSuccessfully",payload:{file:t,response:e}}),a&&a(e,t)},catchFn:e=>{u({type:"finishUploadWithError",payload:{file:t,error:e}}),e.message!==s&&i&&i(e,t)}};o.push(p)}e?o.forEach((e=>{t(e.formData,e.config).then(e.thenFn).catch(e.catchFn)})):o.reduce((async(e,a)=>(await e,t(a.formData,a.config).then(a.thenFn).catch(a.catchFn))),Promise.resolve())},handleCancelUpload:e=>{c.uploads.get(e)?.cancelFn?.cancel(s)},handleRemoveUpload:e=>{u({type:"removeUpload",payload:{file:e}})}}}},50242:(e,t,a)=>{a.r(t),a.d(t,{default:()=>ue});var r=a(63696),n=a(68430),l=a(38914),s=a(57901),o=a(67435),i=a(49348),c=a(10629),u=a(24084),d=a(80735),m=a(82403),p=a(3461),h=a(43566),E=a(87702),y=a(53271),g=a(17327),f=a(64361),v=a(71603),b=a(76072),F=a(97299),S=a(1180),w=a(65753),k=a(24974),q=a(21639),C=a(3939),x=a(55399),M=a(24417),P=a(89101),B=a(91728),O=a(74932),I=a(34066);const $=[{severity:"critical"},{severity:"high"},{severity:"medium"},{severity:"low"},{severity:"none"}],L=()=>{const e=(0,o.Zp)(),{result:{data:t,total:a},isFetching:n,fetchError:L}=(0,B.i$)({page:{pageNumber:1,itemsPerPage:10},sort:{field:"published",direction:"desc"}},!0),{data:K,isFetching:T,fetchError:U}=(0,P.n)(t.map((e=>e.id))),_=K.map((e=>e.summary.vulnerabilityStatus.affected.total)).every((e=>0===e)),N=(e,t)=>`${" ".repeat(t+1)}${e.name}`,{result:{data:W,total:j},isFetching:A,fetchError:D}=(0,O.WJ)({page:{pageNumber:1,itemsPerPage:10},sort:{field:"published",direction:"desc"}},!0);return r.createElement(g.Z,null,r.createElement(f.Z,null,"Your dashboard"),r.createElement(v.b,null,r.createElement(b.x,null,r.createElement(F.E,{md:6},r.createElement(M.a,{isFetching:n||T,fetchError:L||U.some((e=>!!e))},r.createElement(l.B,{hasGutter:!0},r.createElement(s.a,null,r.createElement(S.n,null,"Below is a summary of CVE status for your last 10 ingested SBOMs. You can click on the SBOM name or CVE severity number below to be taken to their respective details page.")),r.createElement(s.a,null,r.createElement("div",{style:{height:320}},r.createElement(c.t,{ariaDesc:"SBOM summary status",domainPadding:{x:[30,25]},legendData:$.map((e=>({name:x.Kb[e.severity].name}))),legendPosition:"bottom-left",height:375,name:"sbom-summary-status",padding:{bottom:75,left:330,right:50,top:50},themeColor:u.L.multiOrdered,width:700,legendComponent:r.createElement(d._,{y:10,x:300,colorScale:$.map((e=>x.Kb[e.severity].color.value))})},r.createElement(m.c,{label:"Products",axisLabelComponent:r.createElement(p.j,{dx:0,x:15,y:140}),tickLabelComponent:r.createElement(p.j,{className:"pf-v5-c-button pf-m-link pf-m-inline",style:[{fill:"#0066cc"}],events:{onClick:a=>{const r=a.target.innerHTML,n=t.find(((e,t)=>N(e,t)===r));n&&e(`/sboms/${n.id}`)}}})}),r.createElement(m.c,{dependentAxis:!0,showGrid:!0,tickValues:_?[1,2,3,4,5,6,7,8,9,10]:void 0,label:"Vulnerabilities by Severity",fixLabelOverlap:!0}),r.createElement(h.R,{horizontal:!0,colorScale:$.map((e=>x.Kb[e.severity].color.value))},$.map((e=>{const a=x.Kb[e.severity];return r.createElement(E._,{key:e.severity,labelComponent:r.createElement(y.I,{constrainToVisibleArea:!0}),data:K.map((({summary:{vulnerabilityStatus:{affected:r}}},n)=>{const l=t[n],s=e.severity,o=r.severities[s];return{x:N(l,n),y:o,label:`${a.name}: ${o}`}}))})}))))))))),r.createElement(F.E,{md:6},r.createElement(M.a,{isFetching:A,fetchError:D},r.createElement(b.x,{hasGutter:!0},r.createElement(F.E,{md:6},r.createElement(w.B,null,r.createElement(k.W,null,r.createElement(q.X,null,"Last SBOM ingested"),r.createElement(C.d,null,r.createElement(l.B,null,r.createElement(s.a,null,(0,I.Yq)(t?.[0]?.published)),r.createElement(s.a,null,r.createElement(i.N_,{to:`/sboms/${t?.[0]?.id}`},t?.[0]?.name))))))),r.createElement(F.E,{md:6},r.createElement(w.B,null,r.createElement(k.W,null,r.createElement(q.X,null,"Total SBOMs"),r.createElement(C.d,null,a)))),r.createElement(F.E,{md:6},r.createElement(w.B,null,r.createElement(k.W,null,r.createElement(q.X,null,"Last Vulnerability ingested"),r.createElement(C.d,null,r.createElement(l.B,null,r.createElement(s.a,null,(0,I.Yq)(W?.[0]?.published)),r.createElement(s.a,null,W?.[0]?.identifier)))))),r.createElement(F.E,{md:6},r.createElement(w.B,null,r.createElement(k.W,null,r.createElement(q.X,null,"Total Vulnerabilities"),r.createElement(C.d,null,j))))))))))};var K=a(59394),T=a(99135),U=a(50705),_=a(39155),N=a(3715),W=a(26667),j=a(77347),A=a(40752);const D="watched-sboms",Y="dashboard",V=r.createContext({}),z=({children:e})=>{const{pushNotification:t}=r.useContext(U.K),{sboms:a,isFetching:n,fetchError:l}=(()=>{const{data:e,isLoading:t,error:a}=(0,_.I)({queryKey:[Y,D],queryFn:async()=>{try{return(await(0,A.oE)({client:j.S,path:{key:D}})).data}catch(e){if(404===e.status)return{sbom1Id:null,sbom2Id:null,sbom3Id:null,sbom4Id:null}}}});return{sboms:e,isFetching:t,fetchError:a}})(),{mutate:s}=(()=>{const e=(0,N.jE)();return(0,W.n)({mutationFn:e=>(0,A.A2)({client:j.S,path:{key:D},body:e}),onSuccess:(t,a)=>{e.invalidateQueries({queryKey:[Y,D]})},onError:e=>{t({title:"Error while updating the user preferences",variant:"danger"})}})})();return r.createElement(V.Provider,{value:{sboms:a,isFetching:n,fetchError:l,patch:(e,t)=>{const r={...a,[e]:t};s(r)}}},e)};var H=a(63863),R=a(99526),G=a(92411),X=a(63392),Z=a(22431),Q=a(62381),J=a(81643),ee=a(4842),te=a(35743),ae=a(77635),re=a(93831),ne=a(77570),le=a(53025),se=a(27473);const oe=({sbomId:e})=>{const{data:t,isFetching:a,fetchError:n}=(0,P.U)(e);return r.createElement(M.a,{isFetching:a,fetchError:n},r.createElement(se.Y,{vulnerabilitiesSummary:t.summary.vulnerabilityStatus.affected}))},ie=({fieldName:e,sbomId:t})=>{const{patch:a}=r.useContext(V),n=r.useRef(),[o,c]=r.useState(""),[u,d]=r.useState("");r.useEffect((()=>{const e=setTimeout((()=>{d(o)}),500);return()=>clearTimeout(e)}),[o,500]);const[m,p]=r.useState(!1),{sbom:h,isFetching:E,fetchError:y}=(0,B.rj)(t??void 0),{result:{data:b},isFetching:F,fetchError:S}=(0,B.i$)({filters:[{field:"",operator:"~",value:u}],page:{pageNumber:1,itemsPerPage:10}},!0),w=()=>{p(!1)},k=()=>{p(!m)},q=()=>{m?o||w():p(!0)},C=(e,t)=>{c(t)},x=()=>{c(""),n?.current?.focus()};return r.createElement(g.Z,{isFullHeight:!0},r.createElement(M.a,{isFetching:E,fetchError:y},h&&r.createElement(f.Z,null,h?.name),r.createElement(v.b,null,t?r.createElement(l.B,null,r.createElement(s.a,{isFilled:!0},r.createElement(oe,{sbomId:t})),r.createElement(s.a,null,r.createElement(i.N_,{to:`/sboms/${t}`},"View Details"))):r.createElement(H.p,{variant:H.s.xs},r.createElement(R.o,{titleText:"There is nothing here yet",headingLevel:"h4"}),r.createElement(G.h,null,"You can get started by uploading an SBOM. Once your SBOMs are uploaded come back to this page to change the SBOMs you would like to track.")))),r.createElement(X.w,null,r.createElement(Z.l,{shouldFocusFirstItemOnOpen:!1,isOpen:m,onSelect:(t,r)=>{r&&a(e,r),w()},onOpenChange:e=>{!e&&w()},toggle:e=>r.createElement(Q.S,{ref:e,variant:"typeahead",onClick:k,isExpanded:m,isFullWidth:!0},r.createElement(J.f,{isPlain:!0},r.createElement(ee.Q,{autoComplete:"off",value:o,onClick:q,onChange:C,innerRef:n,isExpanded:m,placeholder:"Select a new SBOM to watch"}),r.createElement(te.N,{...o?{}:{style:{display:"none"}}},r.createElement(ae.$n,{variant:"plain",onClick:x,"aria-label":"Clear input value"},r.createElement(le.Ay,{"aria-hidden":!0})))))},r.createElement(re.B,null,b.map((e=>r.createElement(ne.O,{key:e.id,value:e.id},e.name)))))))},ce=()=>{const{sboms:e,isFetching:t,fetchError:a}=r.useContext(V);return r.createElement(M.a,{isFetching:t,fetchError:a,isFetchingState:r.createElement(b.x,{hasGutter:!0},Array.from(Array(4).keys()).map(((e,t)=>r.createElement(F.E,{key:t,md:3},r.createElement(g.Z,null,r.createElement(v.b,null,r.createElement(K.a,null,r.createElement(T.y,null))))))))},r.createElement(b.x,{hasGutter:!0},e&&Object.entries(e).map((([e,t])=>r.createElement(F.E,{key:`${e}:${t}`,md:3},r.createElement(ie,{fieldName:e,sbomId:t}))))))},ue=()=>r.createElement(r.Fragment,null,r.createElement(n.d8,null,r.createElement(l.B,{hasGutter:!0},r.createElement(s.a,null,r.createElement(L,null)),r.createElement(s.a,null,r.createElement(z,null,r.createElement(ce,null))))))},91728:(e,t,a)=>{a.d(t,{DH:()=>y,Qr:()=>E,i$:()=>m,rj:()=>p,sn:()=>h,zY:()=>g});var r=a(39155),n=a(3715),l=a(55037),s=a(77347),o=a(40752),i=a(24808),c=a(81230),u=a(70611);const d="sboms",m=(e={},t=!1)=>{const{data:a,isLoading:n,error:l,refetch:i}=(0,r.I)({queryKey:[d,e],queryFn:()=>(0,o.z1)({client:s.S,query:{...(0,u.kd)(e)}}),refetchInterval:!t&&5e3});return{result:{data:a?.data?.items||[],total:a?.data?.total??0,params:e??e},isFetching:n,fetchError:l,refetch:i}},p=e=>{const{data:t,isLoading:a,error:n}=(0,r.I)({queryKey:[d,e],queryFn:()=>void 0===e?Promise.resolve(void 0):(0,o.a7)({client:s.S,path:{id:e}}),enabled:void 0!==e});return{sbom:t?.data,isFetching:a,fetchError:n}},h=()=>{const e=(0,n.jE)();return(0,i.v)({parallel:!0,uploadFn:(e,t)=>(0,c.J4)(e,t),onSuccess:()=>{e.invalidateQueries({queryKey:[d]})}})},E=(e,t={})=>{const{data:a,isLoading:n,error:l,refetch:i}=(0,r.I)({queryKey:["SBOMsQueryKeysss","by-package",e,t],queryFn:()=>(0,o.m9)({client:s.S,query:{id:e,...(0,u.kd)(t)}})});return{result:{data:a?.data?.items||[],total:a?.data?.total??0,params:t??t},isFetching:n,fetchError:l,refetch:i}},y=e=>{const{data:t,isLoading:a,error:n}=(0,r.I)({queryKey:[d,e,"advisory"],queryFn:()=>(0,o.bj)({client:s.S,path:{id:e}})});return{advisories:t?.data||[],isFetching:a,fetchError:n}},g=e=>{const t=(0,l.E)({queries:e.map((e=>({queryKey:[d,e,"advisory"],queryFn:()=>(0,o.bj)({client:s.S,path:{id:e}})})))});return{advisories:t.map((({data:e})=>e?.data||[])),isFetching:t.some((({isLoading:e})=>e)),fetchError:t.map((({error:e})=>e))}}},74932:(e,t,a)=>{a.d(t,{WJ:()=>i,uN:()=>c});var r=a(39155),n=a(77347),l=a(40752),s=a(70611);const o="vulnerabilities",i=(e={},t=!1)=>{const{data:a,isLoading:i,error:c,refetch:u}=(0,r.I)({queryKey:[o,e],queryFn:()=>(0,l.NI)({client:n.S,query:{...(0,s.kd)(e)}}),refetchInterval:!t&&5e3});return{result:{data:a?.data?.items||[],total:a?.data?.total??0,params:e},isFetching:i,fetchError:c,refetch:u}},c=e=>{const{data:t,isLoading:a,error:s}=(0,r.I)({queryKey:[o,e],queryFn:()=>(0,l.wk)({client:n.S,path:{id:e}})});return{vulnerability:t?.data,isFetching:a,fetchError:s}}}}]);
//# sourceMappingURL=669.933c9cfc.min.js.map