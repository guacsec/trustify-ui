import type { Page } from "@playwright/test";

import { expect } from "../../assertions";

import { Navigation } from "../Navigation";
import { Toolbar } from "../Toolbar";
import { Table } from "../Table";
import { Pagination } from "../Pagination";

export class VulnerabilityListPage {
  private readonly _page: Page;

  private constructor(page: Page) {
    this._page = page;
  }

  static async build(page: Page) {
    const navigation = await Navigation.build(page);
    await navigation.goToSidebar("Vulnerabilities");

    return new VulnerabilityListPage(page);
  }

  /**
   * Build the page object from the current page state WITHOUT navigating.
   * Use when already on the Vulnerability List page.
   */
  static async fromCurrentPage(page: Page) {
    // Verify we're on the vulnerability list page by checking for the page heading
    await expect(
      page.getByRole("heading", { level: 1, name: "Vulnerabilities" }),
    ).toBeVisible();

    return new VulnerabilityListPage(page);
  }

  async getToolbar() {
    return await Toolbar.build(this._page, "vulnerability-toolbar");
  }

  async getTable() {
    return await Table.build(this._page, "Vulnerability table");
  }

  async getPagination(top: boolean = true) {
    return await Pagination.build(
      this._page,
      `vulnerability-table-pagination-${top ? "top" : "bottom"}`,
    );
  }
}
